{# templates/components/notifications_center.twig #}

{% block stylesheets %}
    {{ encore_entry_link_tags('notification-style') }}
{% endblock %}

{% block javascripts %}
    {{ encore_entry_script_tags('notification') }}
{% endblock %}

<div id="notifications-container">
    <h3>Notifications</h3>
    {% if notifications is empty %}
        <p>Aucune notification à afficher.</p>
    {% else %}
        <ul>
            {% for notification in notifications %}
                <li class="{{ notification.status == 'unread' ? 'font-bold' : '' }}">
                    {{ notification.message }}
                    <span class="notification-date">{{ notification.createdAt|date('d/m/Y H:i') }}</span>
                    {% if notification.status == 'unread' %}
                        <button class="mark-read" data-id="{{ notification.id }}">Marquer comme lue</button>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    {% block javascripts %}
    {% endif %}
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const buttons = document.querySelectorAll('.mark-read');
        buttons.forEach(function(button) {
            button.addEventListener('click', function() {
                const notificationId = this.getAttribute('data-id');
                fetch('/notifications/mark-as-read/' + notificationId, {
                    method: 'POST',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest',
                        'Content-Type': 'application/json'
                    }
                }).then(response => response.json())
                  .then(data => {
                      if (data.success) {
                          this.parentElement.classList.remove('font-bold');
                          this.remove(); // Supprime le bouton une fois la notification marquée comme lue
                      }
                  });
            });
        });
    });
</script>

<style>
    #notifications-container ul {
        list-style: none;
        padding: 0;
    }

    #notifications-container li {
        margin-bottom: 10px;
        padding: 10px;
        background-color: #f3f3f3;
        border-radius: 5px;
    }

    .notification-date {
        float: right;
        opacity: 0.6;
        font-size: 0.9em;
    }

    .font-bold {
        font-weight: bold;
    }

    button.mark-read {
        margin-left: 10px;
        padding: 5px 10px;
        cursor: pointer;
    }
</style>
